---
title: "Vignette Title"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
# DDHQA WALKTHROUGH
This package automates different quality checks for the World Bank's Data Catalog

## Set up
```{r setup, include = FALSE}
package <- 'tonyfujs/ddhqa'
github_token <- "YOUR TOKEN"
httr::set_config(httr::config(ssl_verifypeer = 0L))
devtools::install_github(package, auth_token = github_token)
```

run credentials
```{r setup, include = FALSE}
url <- 'https://datacatalog.worldbank.org/'
username <- 'USERNAME'
password <- 'PASSWORD'
credentials <- dkanr::dkanr_setup(url, username, password)
```

## GENERAL WORK FLOW
1. Gather all metadata [datasets/resources]
2. Field names being used/unused [datasets/resources]
3. File extension match listed type [resources]
4. External links are valid/check 404 [resources]

### [ 1 ] gather all metadata
The first step to running the quality assurance functions is to gather all the metadata for the nodes you are interested in.

If you would like to look at a larger portion of the datasets, use this approach. Be sure if filter by `data_type` if you are interested.
```{r setup, include = FALSE}
# datasets
datasets_nids <- get_datasets_list(data_type = "all")
datasets <- get_metadata_datasets(datasets_nids)

# resources
resources_nids <- get_resources_list(datasets)
resources <- get_metadata_resources(resources_nids)
```

You may also pass your own subset for nids into the functions. You can do this by getting a list of all the nodes (`nids`) you are interested in analyzing.

### [ 2 ] checking frequency of metadata fields
Call `count_machine_names()` to have a better understanding to see which metadata fields are being used.
These results are will display the frequency of use as well as frequency of the field being empty (null or empty list).

```{r setup, include = FALSE}
# datasets
count_machine_names(datasets)

# resources
count_machine_names(resources)
```

### [ 3 ] file extensions
There are multiple checks to compare resource file extensions:
  * contains `field_format` but is missing a path with the expected file extension
  * contains valid file extension but unpopulated field_format
  * field_format and file extension do not match
  * the incorrect field is being used between the three options (remote file vs. field link api)

First, grab the resources' metadata. Then view the `field_form` and file extension for each of those nids.
```{r setup, include = FALSE}
assemble_file_ext(resources)
```

You can then select which issues you would like to explore.
```{r setup, include = FALSE}
# field_format and file extension do not match
check_file_ext(resources)
```

### [ 4 ] external links
* check if external links are valid
* avoid 404 errors
```{r setup, include = FALSE}
check_resource_links(resources)
```

### [ 5 ] missing recommended fields
```{r setup, include = FALSE}
check_recom_fields(resources)
```
