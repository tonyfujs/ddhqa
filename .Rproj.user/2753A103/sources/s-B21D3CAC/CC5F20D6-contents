#' check_resource_links
#'
#' Check for 404 errors in resource links
#'
#' @param metadata_resources list: object returned by get_metadata_resources or get_metadata_all
#'
#' @return dataframe
#' @export
#'


check_resource_links <- function(metadata_resources) {

  # switch to unlist version instead?
  # see r inferno, this approach has better performance?
  path <- vector("character", length = length(metadata_resources))
  http_code <- vector("character", length = length(metadata_resources))

  # set_config(config(ssl_verifypeer = 0L, timeout_ms = 2000))

  for (i in 1:length(metadata_resources)) {
    resource <- metadata_resources[[i]]

    url_results <- resource %>%
                     extract_file_path %>%
                     inspect_url

    path[i] <- url_results[1]
    http_code[i] <- url_results[2]
  }
  http_df <- data.frame(resource_nid = names(metadata_resources),
                        path,
                        http_code)
  return(http_df)
}


inspect_url <- function(path) {
  resp <- tryCatch({
    httr::GET(path)
  }, error = function(e) {
    cat("ERROR :", conditionMessage(e), "\n")
  })

  if (is.null(resp)) {
    code <- -1
  } else {
    code <- httr::status_code(resp)
  }

  return(c(path, code))
}
